# PDOT Configuration: Prometheus Remote Write Receiver
# Use this config to receive metrics pushed from Prometheus via remote_write

extensions:
  health_check:
    endpoint: 0.0.0.0:${env:OTEL_HEALTHCHECK_PORT:-13133}

receivers:
  prometheusremotewrite:
    endpoint: 0.0.0.0:${env:OTEL_PROMETHEUS_REMOTE_WRITE_PORT:-9090}

processors:
  batch:
    timeout: 30s
    send_batch_size: 10000
    send_batch_max_size: 15000

exporters:
  otlphttp/phoebe:
    endpoint: ${env:OTEL_EXPORTER_ENDPOINT:-https://ingest.phoebe.ai/otel}
    compression: gzip
    headers:
      X-API-Key: ${env:PHOEBE_API_KEY}

service:
  telemetry:
    logs:
      level: "INFO"
      encoding: "json"
    metrics:
      readers:
        - pull:
            exporter:
              prometheus:
                host: ${env:OTEL_PROMETHEUS_HOST:-127.0.0.1}
                port: ${env:OTEL_PROMETHEUS_PORT:-8888}
  extensions:
    - health_check
  pipelines:
    metrics/prometheusremotewrite:
      receivers:
        - prometheusremotewrite
      processors:
        - batch
      exporters:
        - otlphttp/phoebe
