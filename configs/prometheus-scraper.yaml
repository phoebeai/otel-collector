# PDOT Configuration: Prometheus Scraper
# Use this config to scrape /metrics endpoints directly from applications

extensions:
  health_check:
    endpoint: 0.0.0.0:${env:OTEL_HEALTHCHECK_PORT:-13133}

receivers:
  prometheus:
    config:
      scrape_configs:
        - job_name: ${env:OTEL_PROMETHEUS_JOB_NAME:-default}
          scrape_interval: ${env:OTEL_PROMETHEUS_SCRAPE_INTERVAL:-15s}
          scrape_timeout: ${env:OTEL_PROMETHEUS_SCRAPE_TIMEOUT:-10s}
          static_configs: ${env:OTEL_PROMETHEUS_STATIC_CONFIGS:-[]}
          file_sd_configs:
            - files:
                - ${env:OTEL_PROMETHEUS_TARGETS_FILE:-/etc/pdot/targets.yaml}
              refresh_interval: 30s

processors:
  batch:
    timeout: 30s
    send_batch_size: 10000
    send_batch_max_size: 15000

exporters:
  otlphttp/phoebe:
    endpoint: ${env:OTEL_EXPORTER_ENDPOINT:-https://ingest.phoebe.ai/otel}
    compression: gzip
    headers:
      X-API-Key: ${env:PHOEBE_API_KEY}

service:
  telemetry:
    logs:
      level: "INFO"
      encoding: "json"
    metrics:
      readers:
        - pull:
            exporter:
              prometheus:
                host: ${env:OTEL_PROMETHEUS_HOST:-127.0.0.1}
                port: ${env:OTEL_PROMETHEUS_PORT:-8888}
  extensions:
    - health_check
  pipelines:
    metrics/prometheus:
      receivers:
        - prometheus
      processors:
        - batch
      exporters:
        - otlphttp/phoebe
