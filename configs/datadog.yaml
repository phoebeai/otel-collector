# PDOT Configuration: Datadog Agent Replacement
# Use this config to receive traces, metrics, and logs from Datadog agents

extensions:
  health_check:
    endpoint: 0.0.0.0:${env:OTEL_HEALTHCHECK_PORT:-13133}

receivers:
  datadog:
    endpoint: 0.0.0.0:${env:OTEL_DATADOG_RECEIVER_PORT:-8226}
    read_timeout: 60s
    trace_id_cache_size: 100

processors:
  batch:
    timeout: 30s
    send_batch_size: 10000
    send_batch_max_size: 15000

  resourcedetection/env:
    detectors:
      - env
    override: true
    timeout: 5s

  transform/datadoglogs:
    error_mode: "ignore"
    log_statements:
      - set(log.time_unix_nano, log.attributes["timestamp"]*1000000)

exporters:
  otlphttp/phoebe:
    endpoint: ${env:OTEL_EXPORTER_ENDPOINT:-https://ingest.phoebe.ai/otel}
    compression: gzip
    headers:
      X-API-Key: ${env:PHOEBE_API_KEY}

service:
  telemetry:
    logs:
      level: "INFO"
      encoding: "json"
    metrics:
      readers:
        - pull:
            exporter:
              prometheus:
                host: ${env:OTEL_PROMETHEUS_HOST:-127.0.0.1}
                port: ${env:OTEL_PROMETHEUS_PORT:-8888}
  extensions:
    - health_check
  pipelines:
    traces:
      receivers:
        - datadog
      processors:
        - batch
      exporters:
        - otlphttp/phoebe

    metrics:
      receivers:
        - datadog
      processors:
        - resourcedetection/env
        - batch
      exporters:
        - otlphttp/phoebe

    logs:
      receivers:
        - datadog
      processors:
        - transform/datadoglogs
        - batch
      exporters:
        - otlphttp/phoebe
